<!DOCTYPE html>
<html>
	<head>
		<style>
			html,body{margin:0px; padding:0px; width:100%; height:100%;}
			body{background-color:#404040;}

			canvas{border:1px solid black;}
			div{display:flex; width:100%; height:100%; align-items:center; justify-content:center;}
		</style>

		<script src="gl.js"></script>
		<script src="Math.js"></script>
		<script src="shaders.js"></script>
		<script src="RenderLoop.js"></script>
		<script src="Modal.js"></script>
		<script src="Transform.js"></script>
		<script src="Primatives.js"></script>
		<script src="maze.js"></script>
		<script src="Camera.js"></script>
		<script src="Shaders_Extra.js"></script>

		<script>
			var gl, gRLoop,	gShader, gModal, gCamera, gCameraCtrl;
			var gGridShader, gGridModal;

			window.addEventListener("load",function(){
				//Main Setup
				// gl = GLInstance("glcanvas").fSetSize(1000,1000).fClear();
				gl = GLInstance("glcanvas").fFitScreen(0.95,0.9).fClear(); //.fSetSize(500,500)

				gCamera = new Camera(gl);
				gCamera.transform.position.set(0,1,3);
				gCameraCtrl = new CameraController(gl,gCamera);

				//Setup Grid
				gGridShader = new GridAxisShader(gl,gCamera.projectionMatrix);

				// gGridShader = new GridAxisShader(gl,gCamera.projectionMatrix);
				
				// gGridModal = Primatives.GridAxis.createModal(gl,true);
				
				gShader = new TestShader(gl,[ 0.0,0.0,0.0, 0.0,0.0,0.0, 0.0,0.0,0.0, 0.0,0.0,0.0]); //Gray,Red,Green,Blue
				
				//Setup our modal
				//var mesh = gl.fCreateMeshVAO("lines",null,[ 0,1,0, 0,-1,0     ,-1,0,0, 1,0,0 ]);
				//mesh.drawMode = gl.LINES;
				//gModal = new Modal(mesh);
				// var laberintoHardCodeado = {x: 15, y: 20};

				// por aca la cague con algo porque no se actualiza al cambiar los params

				var laberintoHardCodeado = mazePrim(20,20);
				gGridModal = Primatives.GridAxis.createModal(gl,laberintoHardCodeado);
				document.getElementById('out').innerHTML = display(laberintoHardCodeado);
				updateCanvas(laberintoHardCodeado);
				
				//Start Rendering
				RLoop = new RenderLoop(onRender).start();
				
			});

			function onRender(dt){
				// gl.fClear();

				// var p = gModal.transform.position,				//Just an pointer to transform position, make code smaller 
				// 	angle = Math.atan2(p.y,p.x)  + (1*dt),		//Calc the current angle plus 1 degree per second rotation
				// 	radius = Math.sqrt(p.x * p.x + p.y * p.y),	//Calc the distance from origin.
				// 	scale = Math.max(0.2,  Math.abs(Math.sin(angle)) * 1.2  );   //Just messing with numbers and seeing what happens :)

				// //-- Code Style One : Traditional -- 
				// gModal.setScale(scale,scale,1)
				// gModal.setPosition( radius * Math.cos(angle), radius * Math.sin(angle), 0 );
				// gModal.transform.rotation.z += 15 * dt;
				// gModal.transform.rotation.x += 30 * dt;
				// gModal.transform.rotation.y += 60 * dt;
				// gShader.activate().renderModal(gModal.preRender());

				// gShader.activate().renderModal(gModal);

				gCamera.updateViewMatrix();
				gl.fClear();
				
				gGridShader.activate()
					.setCameraMatrix(gCamera.viewMatrix)
					.renderModal( gGridModal.preRender() );
			}

			function updateCanvas(laberintoCreado){
				gModal = new Modal(Primatives.GridAxis.createMesh(gl,laberintoCreado));	
				gl.fClear();
				
				gShader.activate().renderModal(gModal);
			}

			class TestShader extends Shader{
				constructor(gl,aryColor){
					var vertSrc = ShaderUtil.domShaderSrc("vertex_shader"),
						fragSrc = ShaderUtil.domShaderSrc("fragment_shader");
					super(gl,vertSrc,fragSrc);

					//Our shader uses custom uniforms 
					var uColor	= gl.getUniformLocation(this.program,"uColor");
					gl.uniform3fv(uColor, aryColor);

					gl.useProgram(null); //Done setting up shader
				}
			}
		</script>
	</head>
<body>
	<div id="maze" style="height: auto; justify-content: center;">
		<form style="text-align:center" name="forma1">
			<br><label>HEIGHT:</label><br>
			<input type="text" id="height" name="height" autofocus="autofocus" maxlength="2" size="6" />
			<br><label>WIDTH:</label><br>
			<input type="text" id="width" name="width"  maxlength="2" size="6" />
			<br>
		</form>
		<input type="button" alt="submit" onClick="duom();" value="Generate" style="margin-top:10px;" >
		</div>
		<pre id="out" style="justify-content: center;"></pre>
	<div>
		<canvas id="glcanvas"></canvas>
	</div>
	

	<script id="vertex_shader" type="x-shader/x-vertex">#version 300 es
		in vec3 a_position;	//Standard position data.
		layout(location=4) in float a_color;	//Will hold the 4th custom position of the custom position buffer.

		uniform vec3 uColor[4];	//Color Array

		out lowp vec4 color;	//Color to send to fragment shader.
		
		void main(void){
			color = vec4(uColor[ int(a_color) ],1.0); //Using the 4th float as a color index.
			gl_Position = vec4(a_position, 1.0);
		}
	</script>

	<script id="fragment_shader" type="x-shader/x-fragment">#version 300 es
		precision mediump float;

		in vec4 color;
		out vec4 finalColor;
		
		void main(void){ finalColor = color; }
	</script>

	
</body>
</html>